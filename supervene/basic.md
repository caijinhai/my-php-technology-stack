并发在操作系统中，指一段时间中有几个程序都处于已启动运行到运行完毕之间，且这几个程序都在同一处理机上运行，但任意时刻点上只有一个程序在处理机上运行。

在互联网时代，所讲的高并发，其实是高并行。即在某个时间点，多个访问请求同时到达。

如果一个系统的日PV在千万以上，则有可能是一个高并发系统。

## 相关名词
- QPS（Query Per Second）：每秒中请求或查询的数量。

- TPS（Transaction Per Second）：每秒事务数, 是衡量系统性能的一个非常重要的指标。

- 并发连接数：系统同时处理的请求数量。

- 吞吐量：单位时间内处理的请求数量（通常由 QPS 和并发数决定）。

- 响应时间：从请求发出到收到响应所花费的时间。

- PV（Page View）：综合浏览量，指页面浏览量或点击量，一个访客在24小时内访问的页面数量（同一个人浏览网站的同一页面，只记作一次PV）。

- UV（unique visitor）：独立访客。一定时间内相同访客访问同一网站，只记作一个独立访客。

- 带宽：计算带宽大小需要关注两个指标，峰值流量和页面平均大小。

## 计算公式
峰值时间每秒请求数(QPS)
> `( 总PV数 * 80% ) / ( 每天秒数 * 20% )————二八法则`

日网站带宽
> `PV / 统计时间（秒）* 平均页面大小（KB）* 8 * 3600`

## 压力测试

### 目的
- 测试能承受的最大并发
- 测试能承受的最大QPS

### 工具
- AB（Apache BenchMark）
- Apache JMeter

> AB（Apache BenchMark）原理是创建多个并发访问线程，模拟多个访问者同时对某一URL地址进行访问。

## 分析与总结
- 系统的性能由TPS决定，跟并发用户数没有多大关系。在同样的TPS下，可以由不同的用户数去压（通过加思考时间设置）。
- 系统的最大TPS是一定的（在一个范围内），但并发用户数不一定，可以调整。
- 建议性能测试的时候，不要设置过长的思考时间，以最坏的情况下对服务器施压。
- 一般情况下，大型系统（业务量大、机器多）做压力测试，5000个用户并发就够了，中小型系统做压力测试，1000个用户并发就足够了。

---

- QPS 达 50：小型网站，选用一般服务器即可
- QPS 达 100：数据库瓶颈开始出现，可使用缓存和数据库负载均衡
- QPS 达 800：带宽瓶颈开始出现，可使用CDN加速和负载均衡
- QPS 达 1000：数据库缓存瓶颈开始出现，可使用静态HTML缓存
- QPS 达 1000：在这个级别下，文件系统访问锁都成了灾难，可使用业务分离和分布式存储
